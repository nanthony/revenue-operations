<!-- Prebid Config Section START -->
<SCRIPT TYPE='text/javascript' async>

  var PREBID_TIMEOUT = 300;

  var AOL_alias = "aolmarketplacetest_300x250_above";
  if ( window._AdsNativeOpts && window._AdsNativeOpts.widgetId ) {
    AOL_alias = window._AdsNativeOpts.widgetId + "_300x250_above";
  }

  var adUnits = [{
      code: 'div-gpt-ad-1463077789672-0',
      sizes: [[300, 250]],
      bids: [{
          bidder: 'aol',
          params: {
            placement: '3903651',
            network: '10383.1',
            alias: "aolmarketplacetest_300x250_above",
            // sizeId: '',
            bidFloor: '0.1'
          }
        }, {
          bidder: 'openx',
          params: {
            jstag_url: '//disqus-d.openx.net/w/1.0/jstag',
            unit: '538338320' //,
            // pgid: ''
          }
        }, {
          bidder: 'rubicon',
          params: {
            accountId: "13380",
            siteId: "57162",
            zoneId: "368264" //,
            //	sizes: [15],
            // position: ""
          }
      }]
  }];

  var pbjs = pbjs || {};
  pbjs.que = pbjs.que || [];

</SCRIPT>
<!-- Prebid Config Section END -->
 
<!-- Prebid Boilerplate Section START. No Need to Edit. -->
<script type="text/javascript" src="//disqus-inc.github.io/ads-pages/test/prebid.js" async></script>

<!-- Prebid Boilerplate Section START. No Need to Edit. -->
<SCRIPT TYPE="text/javascript">
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
  googletag.cmd.push(function() {
    googletag.pubads().disableInitialLoad();
  });

  pbjs.que.push(function() {
    pbjs.addAdUnits(adUnits);
    pbjs.requestBids({
      // This callback gets triggered when all bids for this
      // ad unit come back.
      bidsBackHandler: sendAdserverRequest
      // bidsBackHandler: function(bidResponses) {
      // var targetingParams = pbjs.getAdserverTargeting();
      // var container = document.getElementById('container');
      // container.innerHTML = JSON.stringify(targetingParams);
      // }
    });
  });

  function sendAdserverRequest() {
    if (pbjs.adserverRequestSent) return;
    pbjs.adserverRequestSent = true;
    googletag.cmd.push(function() {
      pbjs.que.push(function() {
        pbjs.setTargetingForGPTAsync();
        googletag.pubads().refresh();
      });
    });
  };

  setTimeout(function() {
    sendAdserverRequest();
  }, PREBID_TIMEOUT);

</SCRIPT>
<!-- Prebid Boilerplate Section END -->


<P>Prebid.js test</P>
<!-- /101482493/DFP_Passback_300x250 -->
<div id="div-gpt-ad-1463077789672-0" style="height:250px; width:300px; text-align: center; margin: 0 auto;"></div>

<SCRIPT TYPE='text/javascript'>

  function loadTracker(url) {
    var tracker = document.createElement("img");
    tracker.src = url;
    document.body.appendChild(tracker);
  }

  function track_activity( verb, adverb, page_URL ) {
    var URL = '//referrer.disqus.com/juggler/event.gif?experiment=Google_DFP&variant=debug&service=static&bin=embed%3Apromoted_discovery%3Astatic%3AGoogle_DFP%3Adebug&area=top&product=embed&forum=adsnativetest&zone=thread&object_type=provider&object_id=Google_DFP&provider=Google&advertisement_id=10671&ad_product_name=iab_display&ad_product_layout=iab_display&event=activity&section=default&verb=';
    URL = URL + verb + '&adverb=' + adverb + '&forum_id=3551233&page_url=' + encodeURIComponent(page_URL);
    loadTracker(URL);
  }

  // window.track_activity( "request", "initially", "[PAGE-URL]" );

  var google_dfp_timeout = false; 
  document.addEventListener(
    "google_dfp_timeout",
    function() {
      var child = document.getElementById("div-gpt-ad-1463077789672-0");
      var parent = child.parentElement;
      parent.removeChild(child);

      google_dfp_timeout = true;
      // window.track_activity( "timeout", "initially", "[PAGE-URL]" );
    }
  );

  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
  (function() {
    var gads = document.createElement('script');
    gads.async = true;
    gads.type = 'text/javascript';
    var useSSL = 'https:' == document.location.protocol;
    gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
    var node = document.getElementsByTagName('script')[0];
    node.parentNode.insertBefore(gads, node);
  })();

  googletag.cmd.push(function() {
    googletag.defineSlot('/101482493/DFP_Passback_300x250', [300, 250], 'div-gpt-ad-1463077789672-0').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    page_URL = window.document.referrer || window.document.location.href;
    // console.log( "page URL: " + page_URL );
    googletag.pubads().set( "page_url", page_URL );
    googletag.pubads().addEventListener('slotRenderEnded', function(event) {
      if ( event.isEmpty ) {
        // window.track_activity( "respond", "emptily", "[PAGE-URL]" );
        window._an_adNoFill('google_dfp');
      } else {
        if ( window._an_adFill && !google_dfp_timeout ) {
          window._an_adFill('google_dfp');
          // window.track_activity( "respond", "promptly", "[PAGE-URL]" );
        } else {
          // window.track_activity( "respond", "belatedly", "[PAGE-URL]" );
        }
        // window.track_activity( "respond", "fully", "[PAGE-URL]" );
      }
    });
    googletag.enableServices();
  });

  googletag.cmd.push(function() { googletag.display('div-gpt-ad-1463077789672-0'); });
  // window.track_activity( "request", "completely", "[PAGE-URL]" );

</SCRIPT>
