<DIV ID="to_remove" style="height: 360px;">ad loading...</DIV>

<SCRIPT type="text/javascript">
  var first = true
  window.document.addEventListener(
    "adsnative.mrc50.view:in",
    function(){
      postMessage({event: "playerInView", percentageVisible: 50}, "*");

      if ( first ) {
        first = false;
        var child = document.getElementById("to_remove");
        var parent = child.parentElement;
        parent.removeChild(child);
      }
    }
  );

  window.document.addEventListener(
    "adsnative.mrc50.view:out",
    function(){
      postMessage({event: "playerInView", percentageVisible: 0}, "*");
    }
  );
</SCRIPT>

<!-- TAG START { player: "Outstream Demo (ad only)"} -->
<div class="vdb_player vdb_568927c7e4b098feda361f34554203dbe4b064656db31e16" vdb_params="m.o2inline=inview&m.onLoad=getPlayer">
  <script type="text/javascript" src="//delivery.vidible.tv/jsonp/pid=568927c7e4b098feda361f34/554203dbe4b064656db31e16_bein.js?m.o2inline=inview&m.onLoad=getPlayer"></script>
  <script>
    var player;
    var event;

    function getPlayer (e) {
      player = e;
      player.addEventListener(vidible.CONTEXT_ENDED, reloadAdIFrame);
    }

    function updateQueryStringParameter(uri, key, value) {
      var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
      var separator = uri.indexOf('?') !== -1 ? "&" : "?";
      if (uri.match(re)) {
        return uri.replace(re, '$1' + key + "=" + value + '$2');
      }
      else {
        return uri + separator + key + "=" + value;
      }
    }

    function reloadAdIFrame (e) {
//       event = e;
      var anchor = document.createElement('a');
      anchor.href = window.location.href;
      anchor.search = updateQueryStringParameter( window.location.search, "video_allowed", 0 );

      // remove query parameter forcing campaign, if present
      var re = new RegExp("([?&])" + "cid" + "=.*?(&|$)", "i");
      if ( anchor.search.match(re) ) {
        return anchor.search.replace(re, '$1' + '$2');
      }

      window.location.href = anchor.href;
    }
  </script>
</div>
<!-- TAG END -->
